<h2 class="ms-font-rubik ms-color-2b" style="font-size:1.2em" mat-dialog-title>
  <mat-icon style="vertical-align:middle">account_circle</mat-icon> Crear Nuevo Usuario
</h2>
<mat-divider></mat-divider>
<mat-dialog-content class="w3-roung-large">

  <mat-vertical-stepper #stepperFRED class="w3-margin-top w3-round-large">
    <mat-step [stepControl]="personalDataFormGroup" errorMessage="Complete todos los campos requeridos" state="done">

      <ng-template matStepLabel>Datos personales</ng-template>

      <form [formGroup]="personalDataFormGroup">
        <mat-form-field class="w3-margin-right w3-block w3-margin-bottom" style="max-width:200px" appearance="outline">
          <mat-label>Nombres</mat-label>
          <!-- <mat-icon matPrefix style="vertical-align:middle;margin-right:0.5em">account_circle</mat-icon> -->
          <input matInput class="w3-white" type="text" placeholder="Escriba..." formControlName="name"
            autocomplete="off">
          <mat-hint>
            <strong>requerido *</strong>
          </mat-hint>
          <mat-error>
            <strong>requerido *</strong>
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w3-margin-right w3-block w3-margin-bottom" style="max-width:200px" appearance="outline">
          <mat-label>Apellidos</mat-label>
          <!-- <mat-icon matPrefix style="vertical-align:middle;margin-right:0.5em">account_circle</mat-icon> -->
          <input matInput type="text" placeholder="Escriba..." formControlName="lastname" autocomplete="off">
          <mat-hint>
            <strong>requerido *</strong>
          </mat-hint>
          <mat-error>
            <strong>requerido *</strong>
          </mat-error>
        </mat-form-field>

        <br>

        <mat-form-field class="w3-margin-right w3-block w3-margin-bottom" style="max-width:200px" appearance="outline">
          <mat-label>Correo</mat-label>
          <!-- <mat-icon matPrefix style="vertical-align:middle;margin-right:0.5em">email</mat-icon> -->
          <input matInput type="text" placeholder="Escriba..." formControlName="email" autocomplete="off">
          <mat-hint *ngIf="(duplicated$|async)">
            <strong>correo ya existe en el sistema.</strong>
          </mat-hint>
          <mat-hint *ngIf="!(duplicated$|async)">
            <strong>requerido *</strong>
          </mat-hint>
          <mat-error>
            <strong>requerido *</strong>
          </mat-error>
        </mat-form-field>

        <mat-form-field class="w3-margin-right w3-block w3-margin-bottom" style="max-width:200px" appearance="outline">
          <mat-label>Celular</mat-label>
          <!-- <mat-icon matPrefix style="vertical-align:middle;margin-right:0.5em">phone_iphone</mat-icon> -->
          <input matInput type="number" placeholder="Escriba..." formControlName="phone" autocomplete="off">
        </mat-form-field>

        <mat-form-field *ngIf="!data" class="w3-margin-right w3-block w3-margin-bottom" style="max-width:200px"
          appearance="outline">
          <mat-label>Password</mat-label>
          <!-- <mat-icon matPrefix style="vertical-align:middle;margin-right:0.5em">vpn_key</mat-icon> -->
          <mat-icon matSuffix style="vertical-align:middle" *ngIf="visibility === 'password'"
            (click)="toggleVisibility()">visibility</mat-icon>
          <mat-icon matSuffix style="vertical-align:middle" *ngIf="visibility === 'text'" (click)="toggleVisibility()">
            visibility_off</mat-icon>
          <input matInput [type]="visibility" placeholder="Escriba..." formControlName="password" autocomplete="off">
          <mat-hint>
            <strong>requerido *</strong>
          </mat-hint>
          <mat-error>
            <strong>requerido *</strong>
          </mat-error>
        </mat-form-field>

        <div class="w3-margin-top">
          <button mat-stroked-button matStepperNext>Siguiente</button>
        </div>

      </form>
    </mat-step>

    <mat-step [stepControl]="jobDataFormGroup" errorMessage="Complete todos los campos requeridos" state="done">

      <ng-template matStepLabel>Datos de trabajo</ng-template>

      <form [formGroup]="jobDataFormGroup">
        <mat-form-field class="w3-margin-right w3-block w3-margin-bottom" style="max-width:200px" appearance="outline">
          <mat-label>Puesto/Cargo</mat-label>
          <!-- <mat-icon matPrefix style="vertical-align:middle;margin-right:0.5em">work</mat-icon> -->
          <input matInput type="text" placeholder="Escriba..." formControlName="jobTitle" autocomplete="off">
          <mat-hint>
            <strong>requerido *</strong>
          </mat-hint>
          <mat-error>
            <strong>requerido *</strong>
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w3-margin-right w3-block w3-margin-bottom" style="max-width:200px">
          <mat-label>Rol</mat-label>
          <mat-select formControlName='role'>
            <mat-option value="admin">Administrador</mat-option>
            <mat-option value="communicator">Comunicador</mat-option>
            <mat-option value="user">Usuario</mat-option>
          </mat-select>
          <mat-hint>
            <strong>requerido *</strong>
          </mat-hint>
          <mat-error>
            <strong>requerido *</strong>
          </mat-error>
        </mat-form-field>


        <div>
          <button mat-stroked-button matStepperPrevious class="w3-margin-right w3-margin-top">Anterior</button>
        </div>

      </form>
    </mat-step>
  </mat-vertical-stepper>
</mat-dialog-content>

<mat-dialog-actions class="w3-margin-top w3-margin-bottom" style="border-top: 1px solid lightgray;">
  <button mat-raised-button mat-dialog-close color="warn">Cancelar</button>
  <button *ngIf="data" mat-raised-button color="primary" (click)="updateUser(data.uid)"
    [disabled]="!(personalDataFormGroup.valid && jobDataFormGroup.valid && !(duplicated$|async)) || loading"  mat-dialog-close > Editar
  </button>
  <button mat-raised-button *ngIf="!data" color="primary" (click)="create()"
    [disabled]="!(personalDataFormGroup.valid && jobDataFormGroup.valid && !(duplicated$|async)) || loading">Crear</button>
</mat-dialog-actions>